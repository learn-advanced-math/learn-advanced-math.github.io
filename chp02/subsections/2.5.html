<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="alternate icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMiAzMiI+PGNpcmNsZSBjeD0iMTYiIGN5PSIxNiIgcj0iMTUiIGZpbGw9IiMzNDk4ZGIiIHN0cm9rZT0iIzJjM2U1MCIgc3Ryb2tlLXdpZHRoPSIyIi8+PGcgZmlsbD0id2hpdGUiIGZvbnQtZmFtaWx5PSJUaW1lcyxzZXJpZiIgZm9udC13ZWlnaHQ9ImJvbGQiPjx0ZXh0IHg9IjE2IiB5PSIxMyIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1zaXplPSIxMiI+ZDwvdGV4dD48bGluZSB4MT0iOCIgeTE9IjE2IiB4Mj0iMjQiIHkyPSIxNiIgc3Ryb2tlPSJ3aGl0ZSIgc3Ryb2tlLXdpZHRoPSIxLjUiLz48dGV4dCB4PSIxNiIgeT0iMjUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZvbnQtc2l6ZT0iMTAiPmR4PC90ZXh0PjwvZz48L3N2Zz4=">
    <title>2.5 函数的微分 - 高等数学复习</title>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$']],
                displayMath: [['$$', '$$']]
            },
            chtml: {
                fontURL: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2'
            }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://cdn.plot.ly/plotly-2.26.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.2/dist/gsap.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', 'Segoe UI', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .back-link {
            display: inline-flex;
            align-items: center;
            margin-bottom: 20px;
            color: #3498db;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px 15px;
            border-radius: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .back-link:hover {
            color: #2980b9;
            transform: translateX(-5px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
        }
        
        .back-link::before {
            content: '←';
            margin-right: 8px;
            font-size: 1.2em;
        }
        
        header {
            background: linear-gradient(135deg, #8e44ad 0%, #7d3c98 100%);
            color: white;
            padding: 40px 0;
            text-align: center;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }
        
        h1 {
            font-size: 2.5em;
            margin: 0;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            font-weight: 300;
        }
        
        .subtitle {
            font-size: 1.1em;
            margin-top: 10px;
            opacity: 0.9;
        }
        
        .content-section {
            background: white;
            margin: 25px 0;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .content-section:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .section-header {
            padding: 20px 30px;
            background: linear-gradient(45deg, #8e44ad, #7d3c98);
            color: white;
        }
        
        .section-header h2 {
            margin: 0;
            font-size: 1.6em;
            font-weight: 400;
        }
        
        .section-content {
            padding: 30px;
        }
        
        .definition {
            background: linear-gradient(135deg, #f3e8f7, #e8d5f0);
            border-left: 5px solid #8e44ad;
            padding: 25px;
            margin: 20px 0;
            border-radius: 0 10px 10px 0;
            box-shadow: 0 3px 15px rgba(142, 68, 173, 0.1);
        }
        
        .definition h4 {
            margin: 0 0 15px 0;
            color: #8e44ad;
            font-size: 1.3em;
            font-weight: 600;
        }
        
        .theorem {
            background: linear-gradient(135deg, #fef9e7, #fcf4dd);
            border-left: 5px solid #f39c12;
            padding: 25px;
            margin: 20px 0;
            border-radius: 0 10px 10px 0;
            box-shadow: 0 3px 15px rgba(243, 156, 18, 0.1);
        }
        
        .theorem h4 {
            margin: 0 0 15px 0;
            color: #f39c12;
            font-size: 1.3em;
            font-weight: 600;
        }
        
        .example {
            background: linear-gradient(135deg, #ebf3fd, #d6e9f8);
            border-left: 5px solid #3498db;
            padding: 25px;
            margin: 20px 0;
            border-radius: 0 10px 10px 0;
            box-shadow: 0 3px 15px rgba(52, 152, 219, 0.1);
        }
        
        .example h4 {
            margin: 0 0 15px 0;
            color: #3498db;
            font-size: 1.3em;
            font-weight: 600;
        }
        
        .practice-problem {
            background: linear-gradient(135deg, #fdf2e9, #fbeee0);
            border-left: 5px solid #e67e22;
            padding: 25px;
            margin: 20px 0;
            border-radius: 0 10px 10px 0;
            box-shadow: 0 3px 15px rgba(230, 126, 34, 0.1);
        }
        
        .practice-problem h4 {
            margin: 0 0 15px 0;
            color: #e67e22;
            font-size: 1.3em;
            font-weight: 600;
        }
        
        .difficulty {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: 500;
            margin-left: 10px;
        }
        
        .difficulty.medium {
            background: #f39c12;
            color: white;
        }
        
        .difficulty.hard {
            background: #e74c3c;
            color: white;
        }
        
        .difficulty.very-hard {
            background: #8e44ad;
            color: white;
        }
        
        .solution {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px dashed #bdc3c7;
        }
        
        .solution-header {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.1em;
        }
        
        .viz-container {
            width: 100%;
            height: 400px;
            margin: 25px 0;
            background: white;
            border-radius: 10px;
            box-shadow: 0 3px 15px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .interactive-demo {
            width: 100%;
            height: auto;
            min-height: 480px;
            margin: 25px 0;
            background: #f8f9fa;
            border-radius: 10px;
            box-shadow: 0 3px 15px rgba(0,0,0,0.1);
            padding: 20px;
            position: relative;
        }
        
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .controls label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #8e44ad;
        }
        
        .controls input, .controls select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .nav-buttons {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 40px;
            padding: 20px 0;
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            padding: 12px 25px;
            background: linear-gradient(45deg, #8e44ad, #7d3c98);
            color: white;
            text-decoration: none;
            border-radius: 25px;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 3px 15px rgba(142, 68, 173, 0.3);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(142, 68, 173, 0.4);
        }
        
        .btn.prev::before {
            content: '←';
            margin-right: 8px;
            font-size: 1.1em;
        }
        
        .btn.next::after {
            content: '→';
            margin-left: 8px;
            font-size: 1.1em;
        }
        
        footer {
            text-align: center;
            color: white;
            padding: 30px 0;
            opacity: 0.9;
            margin-top: 50px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        footer p {
            text-align: center;
            margin: 0;
        }
        
        .math-expression {
            text-align: center;
            margin: 15px 0;
            font-size: 1.1em;
        }
        
        ul, ol {
            margin-left: 20px;
            margin-bottom: 15px;
        }
        
        li {
            margin-bottom: 8px;
        }
        
        p {
            margin-bottom: 15px;
            text-align: justify;
        }
        
        .highlight {
            background: linear-gradient(135deg, #f0eaff, #e8d5f0);
            padding: 15px;
            border-left: 4px solid #8e44ad;
            border-radius: 0 8px 8px 0;
            margin: 15px 0;
        }
        
        .differential-demo {
            width: 100%;
            height: 400px;
            margin: 25px 0;
            background: white;
            border-radius: 10px;
            box-shadow: 0 3px 15px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .approximation-demo {
            width: 100%;
            height: 400px;
            margin: 25px 0;
            background: white;
            border-radius: 10px;
            box-shadow: 0 3px 15px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .error-analysis-demo {
            width: 100%;
            height: 400px;
            margin: 25px 0;
            background: white;
            border-radius: 10px;
            box-shadow: 0 3px 15px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .formula-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .formula-card {
            background: linear-gradient(135deg, #dbbfff 0%, #f0eaff 50%, #f8f4ff 100%);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(142, 68, 173, 0.2);
            text-align: center;
        }
        
        .formula-card h5 {
            color: #8e44ad;
            font-size: 1.2em;
            margin-bottom: 15px;
        }
        
        .formula-card .formula {
            font-size: 1.2em;
            margin: 15px 0;
            color: #2c3e50;
        }
        
        .rule-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .rule-item {
            background: linear-gradient(135deg, #f8f4ff, #f0eaff);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #8e44ad;
        }
        
        .rule-item h6 {
            color: #8e44ad;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        /* AI提示方块样式 */
        .ai-warning {
            position: fixed;
            top: 20px;
            left: 20px;
            width: 40px;
            height: 40px;
            background: white;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 1000;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            border: 2px solid #e0e0e0;
        }
        
        .ai-warning:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
            border-color: #ff4444;
        }
        
        .ai-warning::before {
            content: '!';
            color: #e74c3c;
            font-size: 20px;
            font-weight: bold;
            font-family: Arial, sans-serif;
        }
        
        .ai-warning-tooltip {
            position: absolute;
            top: 50px;
            left: 0;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 16px 20px;
            border-radius: 8px;
            font-size: 14px;
            line-height: 1.5;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            z-index: 1001;
            width: 250px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }
        
        .ai-warning-tooltip::before {
            content: '';
            position: absolute;
            top: -8px;
            left: 20px;
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-bottom: 8px solid rgba(0, 0, 0, 0.9);
        }
        
        .ai-warning:hover .ai-warning-tooltip {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .section-content {
                padding: 20px;
            }
            
            .definition, .theorem, .example, .practice-problem {
                padding: 20px;
            }
            
            .nav-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .controls {
                grid-template-columns: 1fr;
            }

            .ai-warning {
                width: 35px;
                height: 35px;
                top: 15px;
                left: 15px;
            }
            
            .ai-warning::before {
                font-size: 18px;
            }
            
            .ai-warning-tooltip {
                width: 280px;
                font-size: 13px;
                padding: 14px 18px;
            }
        }
    </style>
</head>
<body>
    <!-- AI内容提示 -->
    <div class="ai-warning">
        <div class="ai-warning-tooltip">
            页面内容由AI生成，请谨慎对待。<br>如发现错误，<a href="https://github.com/learn-advanced-math/learn-advanced-math.github.io/issues" target="_blank" style="color: #ff0000">欢迎反馈</a>。
        </div>
    </div>
    
    <div class="container">
        <a href="../index.html" class="back-link">返回章节概览</a>
        
        <header>
            <h1>2.5 函数的微分</h1>
            <div class="subtitle">Differential of Functions</div>
        </header>
        
        <!-- 2.5.1 微分的定义及几何意义 -->
        <div class="content-section">
            <div class="section-header">
                <h2>2.5.1 微分的定义及几何意义</h2>
            </div>
            <div class="section-content">
                <div class="definition">
                    <h4>微分的定义</h4>
                    <p>设函数 $y = f(x)$ 在点 $x_0$ 处可导，当自变量在 $x_0$ 处有增量 $\Delta x$ 时，函数的增量为：</p>
                    <div class="math-expression">
                        $$\Delta y = f(x_0 + \Delta x) - f(x_0)$$
                    </div>
                    <p>如果函数的增量 $\Delta y$ 可以表示为：</p>
                    <div class="math-expression">
                        $$\Delta y = A \cdot \Delta x + o(\Delta x)$$
                    </div>
                    <p>其中 $A$ 是不依赖于 $\Delta x$ 的常数，$o(\Delta x)$ 是比 $\Delta x$ 高阶的无穷小，则称函数 $y = f(x)$ 在点 $x_0$ 处<strong>可微</strong>，并称 $A \cdot \Delta x$ 为函数在点 $x_0$ 处的<strong>微分</strong>，记作 $dy$ 或 $df(x_0)$。</p>
                    
                    <div class="highlight">
                        <p><strong>微分公式：</strong> $dy = f'(x_0) \cdot \Delta x$</p>
                        <p>通常记 $\Delta x = dx$，所以微分可写成：$dy = f'(x) \cdot dx$</p>
                    </div>
                </div>
                
                <div class="theorem">
                    <h4>可微与可导的关系</h4>
                    <p>函数 $f(x)$ 在点 $x_0$ 处可微的<strong>充分必要条件</strong>是函数在该点处可导。</p>
                    
                    <div class="math-expression">
                        $$f(x) \text{ 在 } x_0 \text{ 处可微} \Leftrightarrow f(x) \text{ 在 } x_0 \text{ 处可导}$$
                    </div>
                    
                    <p>且当函数在点 $x_0$ 可微时，有 $A = f'(x_0)$。</p>
                </div>
                
                <div class="definition">
                    <h4>微分的几何意义</h4>
                    <p>设函数 $y = f(x)$ 在点 $M(x_0, y_0)$ 处可导，过点 $M$ 作曲线的切线，切线的倾斜角为 $\alpha$，则 $\tan \alpha = f'(x_0)$。</p>
                    
                    <ul>
                        <li><strong>函数增量 $\Delta y$</strong>：曲线上两点间纵坐标的差</li>
                        <li><strong>微分 $dy$</strong>：切线上两点间纵坐标的差</li>
                        <li><strong>几何意义</strong>：微分 $dy$ 是函数增量 $\Delta y$ 的线性主部</li>
                    </ul>
                </div>
                
                <div class="interactive-demo">
                    <div class="controls">
                        <div class="control-group">
                            <label for="function-select">选择函数：</label>
                            <select id="function-select">
                                <option value="quadratic">y = x²</option>
                                <option value="cubic">y = x³</option>
                                <option value="sqrt">y = √x</option>
                                <option value="sin">y = sin(x)</option>
                                <option value="exp">y = eˣ</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label for="x0-slider">基准点 x₀：</label>
                            <input type="range" id="x0-slider" min="-2" max="3" step="0.1" value="1">
                            <span id="x0-value">1.0</span>
                        </div>
                        <div class="control-group">
                            <label for="dx-slider">增量 Δx：</label>
                            <input type="range" id="dx-slider" min="0.1" max="1.5" step="0.05" value="0.5">
                            <span id="dx-value">0.50</span>
                        </div>
                    </div>
                    <div class="differential-demo" id="differential-geometry-plot"></div>
                    <div style="margin-top: 15px; padding: 15px; background: rgba(142, 68, 173, 0.1); border-radius: 8px;">
                        <p><strong>交互说明：</strong></p>
                        <ul style="margin: 10px 0; font-size: 0.95em;">
                            <li>选择不同函数观察微分的几何意义</li>
                            <li>拖动滑块调整基准点 x₀ 和增量 Δx</li>
                            <li>观察函数增量 Δy（绿色）与微分 dy（橙色）的关系</li>
                            <li>注意误差项（红色）随 Δx 减小而减小</li>
                        </ul>
                    </div>
                </div>
                
                <div class="example">
                    <h4>例1：求函数的微分</h4>
                    <p>求 $y = x^3 + 2x^2 - 5x + 1$ 的微分。</p>
                    
                    <div class="solution">
                        <div class="solution-header">解：</div>
                        <p>首先求导数：</p>
                        $$y' = \frac{d}{dx}(x^3 + 2x^2 - 5x + 1) = 3x^2 + 4x - 5$$
                        
                        <p>因此微分为：</p>
                        $$dy = (3x^2 + 4x - 5)dx$$
                    </div>
                </div>
                
                <div class="example">
                    <h4>例2：验证微分的定义</h4>
                    <p>验证函数 $f(x) = x^2$ 在 $x_0 = 2$ 处的微分定义。</p>
                    
                    <div class="solution">
                        <div class="solution-header">解：</div>
                        <p>计算函数增量：</p>
                        $$\Delta y = f(2 + \Delta x) - f(2) = (2 + \Delta x)^2 - 4$$
                        $$= 4 + 4\Delta x + (\Delta x)^2 - 4 = 4\Delta x + (\Delta x)^2$$
                        
                        <p>其中 $4\Delta x$ 是 $\Delta x$ 的一次项（线性主部），$(\Delta x)^2$ 是 $\Delta x$ 的高阶无穷小。</p>
                        <p>因此，$A = 4 = f'(2)$，微分为：$dy = 4dx$</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 2.5.2 基本初等函数的微分公式 -->
        <div class="content-section">
            <div class="section-header">
                <h2>2.5.2 基本初等函数的微分公式</h2>
            </div>
            <div class="section-content">
                <div class="theorem">
                    <h4>基本微分公式</h4>
                    <p>由于 $dy = f'(x)dx$，所以只要知道函数的导数，就能得到微分公式。</p>
                </div>
                
                <div class="formula-cards">
                    <div class="formula-card">
                        <h5>常数函数</h5>
                        <div class="formula">$$d(c) = 0$$</div>
                    </div>
                    <div class="formula-card">
                        <h5>幂函数</h5>
                        <div class="formula">$$d(x^n) = nx^{n-1}dx$$</div>
                    </div>
                    <div class="formula-card">
                        <h5>指数函数</h5>
                        <div class="formula">$$d(e^x) = e^x dx$$</div>
                        <div class="formula">$$d(a^x) = a^x \ln a \, dx$$</div>
                    </div>
                    <div class="formula-card">
                        <h5>对数函数</h5>
                        <div class="formula">$$d(\ln x) = \frac{1}{x}dx$$</div>
                        <div class="formula">$$d(\log_a x) = \frac{1}{x \ln a}dx$$</div>
                    </div>
                    <div class="formula-card">
                        <h5>三角函数</h5>
                        <div class="formula">$$d(\sin x) = \cos x \, dx$$</div>
                        <div class="formula">$$d(\cos x) = -\sin x \, dx$$</div>
                    </div>
                    <div class="formula-card">
                        <h5>反三角函数</h5>
                        <div class="formula">$$d(\arcsin x) = \frac{1}{\sqrt{1-x^2}}dx$$</div>
                        <div class="formula">$$d(\arctan x) = \frac{1}{1+x^2}dx$$</div>
                    </div>
                </div>
                
                <div class="example">
                    <h4>例1：基本函数微分计算</h4>
                    <p>求下列函数的微分：</p>
                    <ol>
                        <li>$y = \sqrt{x}$</li>
                        <li>$y = \frac{1}{x^2}$</li>
                        <li>$y = 3^x$</li>
                    </ol>
                    
                    <div class="solution">
                        <div class="solution-header">解：</div>
                        <p><strong>(1)</strong> $y = \sqrt{x} = x^{1/2}$</p>
                        $$dy = \frac{1}{2}x^{-1/2}dx = \frac{1}{2\sqrt{x}}dx$$
                        
                        <p><strong>(2)</strong> $y = \frac{1}{x^2} = x^{-2}$</p>
                        $$dy = -2x^{-3}dx = -\frac{2}{x^3}dx$$
                        
                        <p><strong>(3)</strong> $y = 3^x$</p>
                        $$dy = 3^x \ln 3 \, dx$$
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 2.5.3 微分法则 -->
        <div class="content-section">
            <div class="section-header">
                <h2>2.5.3 函数的微分法则</h2>
            </div>
            <div class="section-content">
                <div class="theorem">
                    <h4>微分运算法则</h4>
                    <p>设 $u = u(x)$，$v = v(x)$ 都可微，则有：</p>
                    
                    <div class="rule-grid">
                        <div class="rule-item">
                            <h6>线性法则</h6>
                            $$d(au + bv) = a \, du + b \, dv$$
                        </div>
                        <div class="rule-item">
                            <h6>乘积法则</h6>
                            $$d(uv) = v \, du + u \, dv$$
                        </div>
                        <div class="rule-item">
                            <h6>商法则</h6>
                            $$d\left(\frac{u}{v}\right) = \frac{v \, du - u \, dv}{v^2}$$
                        </div>
                        <div class="rule-item">
                            <h6>复合函数法则</h6>
                            $$d[f(u)] = f'(u) \, du$$
                        </div>
                    </div>
                </div>
                
                <div class="highlight">
                    <p><strong>微分形式的不变性：</strong>无论 $u$ 是自变量还是中间变量，$d[f(u)] = f'(u) \, du$ 的形式都保持不变。这是微分的一个重要性质。</p>
                </div>
                
                <div class="example">
                    <h4>例1：乘积法则的应用</h4>
                    <p>求 $y = x^2 \sin x$ 的微分。</p>
                    
                    <div class="solution">
                        <div class="solution-header">解：</div>
                        <p>设 $u = x^2$，$v = \sin x$，则：</p>
                        <p>$du = 2x \, dx$，$dv = \cos x \, dx$</p>
                        
                        <p>应用乘积法则：</p>
                        $$dy = d(uv) = v \, du + u \, dv$$
                        $$= \sin x \cdot 2x \, dx + x^2 \cdot \cos x \, dx$$
                        $$= (2x \sin x + x^2 \cos x) dx$$
                    </div>
                </div>
                
                <div class="example">
                    <h4>例2：复合函数微分</h4>
                    <p>求 $y = \ln(\sin x)$ 的微分。</p>
                    
                    <div class="solution">
                        <div class="solution-header">解：</div>
                        <p>设 $u = \sin x$，则 $y = \ln u$</p>
                        
                        <p>由复合函数微分法则：</p>
                        $$dy = d[\ln u] = \frac{1}{u} \, du = \frac{1}{\sin x} \cdot d(\sin x)$$
                        $$= \frac{1}{\sin x} \cdot \cos x \, dx = \cot x \, dx$$
                    </div>
                </div>
                
                <div class="example">
                    <h4>例3：商法则的应用</h4>
                    <p>求 $y = \frac{e^x}{x^2 + 1}$ 的微分。</p>
                    
                    <div class="solution">
                        <div class="solution-header">解：</div>
                        <p>设 $u = e^x$，$v = x^2 + 1$，则：</p>
                        <p>$du = e^x dx$，$dv = 2x \, dx$</p>
                        
                        <p>应用商法则：</p>
                        $$dy = d\left(\frac{u}{v}\right) = \frac{v \, du - u \, dv}{v^2}$$
                        $$= \frac{(x^2+1) \cdot e^x dx - e^x \cdot 2x \, dx}{(x^2+1)^2}$$
                        $$= \frac{e^x(x^2+1-2x)}{(x^2+1)^2} dx = \frac{e^x(x^2-2x+1)}{(x^2+1)^2} dx$$
                        $$= \frac{e^x(x-1)^2}{(x^2+1)^2} dx$$
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 2.5.4 微分在近似计算中的应用 -->
        <div class="content-section">
            <div class="section-header">
                <h2>2.5.4 微分在近似计算中的应用</h2>
            </div>
            <div class="section-content">
                <div class="theorem">
                    <h4>微分的近似公式</h4>
                    <p>当 $|\Delta x|$ 很小时，有近似公式：</p>
                    <div class="math-expression">
                        $$\Delta y \approx dy = f'(x_0) \Delta x$$
                    </div>
                    <p>即：</p>
                    <div class="math-expression">
                        $$f(x_0 + \Delta x) - f(x_0) \approx f'(x_0) \Delta x$$
                    </div>
                    <p>或写成：</p>
                    <div class="math-expression">
                        $$f(x_0 + \Delta x) \approx f(x_0) + f'(x_0) \Delta x$$
                    </div>
                </div>
                
                <div class="approximation-demo" id="approximation-plot"></div>
                
                <div class="definition">
                    <h4>误差分析</h4>
                    <p>在实际测量中，设测量值为 $x$，真实值为 $x_0$：</p>
                    <ul>
                        <li><strong>绝对误差</strong>：$\Delta x = x - x_0$</li>
                        <li><strong>相对误差</strong>：$\frac{\Delta x}{x_0}$</li>
                        <li><strong>函数值的绝对误差</strong>：$\Delta y \approx f'(x_0) \Delta x$</li>
                        <li><strong>函数值的相对误差</strong>：$\frac{\Delta y}{y_0} \approx \frac{f'(x_0)}{f(x_0)} \Delta x$</li>
                    </ul>
                </div>
                
                <div class="interactive-demo">
                    <div class="controls">
                        <div class="control-group">
                            <label for="error-function-select">选择函数：</label>
                            <select id="error-function-select">
                                <option value="sqrt">f(x) = √x</option>
                                <option value="quadratic">f(x) = x²</option>
                                <option value="sin">f(x) = sin(x)</option>
                                <option value="exp">f(x) = eˣ</option>
                                <option value="ln">f(x) = ln(x)</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label for="x0-error-slider">基准点 x₀：</label>
                            <input type="range" id="x0-error-slider" min="0.5" max="3" step="0.1" value="2">
                            <span id="x0-error-value">2.0</span>
                        </div>
                        <div class="control-group">
                            <label for="max-dx-slider">最大增量范围：</label>
                            <input type="range" id="max-dx-slider" min="0.2" max="1.0" step="0.05" value="0.5">
                            <span id="max-dx-value">0.50</span>
                        </div>
                    </div>
                    <div class="error-analysis-demo" id="error-analysis-plot"></div>
                    <div style="margin-top: 15px; padding: 15px; background: rgba(142, 68, 173, 0.1); border-radius: 8px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; font-size: 1.0em;">
                            <div>
                                <p><strong>误差分析说明：</strong></p>
                                <ul style="margin: 5px 0;">
                                    <li>红色曲线：绝对误差 |真实值 - 近似值|</li>
                                    <li>蓝色曲线：相对误差百分比</li>
                                    <li>观察：$\Delta x$ 越小，误差越小</li>
                                </ul>
                            </div>
                            <div id="error-stats" style="background: white; padding: 10px; border-radius: 5px; font-family: monospace; font-size: 1.0em;">
                                <p><strong>实时统计：</strong></p>
                                <p>函数：f(x) = √x</p>
                                <p>基准点：x₀ = 2.0</p>
                                <p>最大绝对误差：0.0000</p>
                                <p>最大相对误差：0.00%</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="example">
                    <h4>例1：近似计算</h4>
                    <p>利用微分近似计算 $\sqrt{4.01}$。</p>
                    
                    <div class="solution">
                        <div class="solution-header">解：</div>
                        <p>设 $f(x) = \sqrt{x}$，取 $x_0 = 4$，$\Delta x = 0.01$</p>
                        <p>$f'(x) = \frac{1}{2\sqrt{x}}$，所以 $f'(4) = \frac{1}{2\sqrt{4}} = \frac{1}{4}$</p>
                        
                        <p>应用近似公式：</p>
                        $$\sqrt{4.01} = f(4.01) \approx f(4) + f'(4) \cdot 0.01$$
                        $$= 2 + \frac{1}{4} \times 0.01 = 2 + 0.0025 = 2.0025$$
                        
                        <p>精确值：$\sqrt{4.01} \approx 2.00249844$</p>
                        <p>误差：$|2.0025 - 2.00249844| \approx 0.00000156$</p>
                    </div>
                </div>
                
                <div class="example">
                    <h4>例2：误差估计</h4>
                    <p>测量圆的半径时，测得 $r = 10$ cm，测量的绝对误差不超过 $0.1$ cm。求圆面积计算的绝对误差和相对误差的估计值。</p>
                    
                    <div class="solution">
                        <div class="solution-header">解：</div>
                        <p>圆面积公式：$S = \pi r^2$</p>
                        <p>$S'(r) = 2\pi r$，所以 $S'(10) = 20\pi$</p>
                        
                        <p><strong>绝对误差估计：</strong></p>
                        $$|\Delta S| \approx |S'(10)| \cdot |\Delta r| = 20\pi \times 0.1 = 2\pi \approx 6.28 \text{ cm}^2$$
                        
                        <p><strong>相对误差估计：</strong></p>
                        <p>当 $r = 10$ 时，$S = 100\pi$</p>
                        $$\left|\frac{\Delta S}{S}\right| \approx \frac{|S'(10)|}{|S(10)|} \cdot |\Delta r| = \frac{20\pi}{100\pi} \times 0.1 = 0.02 = 2\%$$
                    </div>
                </div>
                
                <div class="example">
                    <h4>例3：常用近似公式</h4>
                    <p>当 $|x|$ 很小时，常用的近似公式（$x \to 0$）：</p>
                    
                    <div class="solution">
                        <div class="solution-header">常用近似公式：</div>
                        <div class="rule-grid">
                            <div class="rule-item">
                                <h6>$(1+x)^n$</h6>
                                $$(1+x)^n \approx 1 + nx$$
                            </div>
                            <div class="rule-item">
                                <h6>$\sin x$</h6>
                                $$\sin x \approx x$$
                            </div>
                            <div class="rule-item">
                                <h6>$\cos x$</h6>
                                $$\cos x \approx 1 - \frac{x^2}{2}$$
                            </div>
                            <div class="rule-item">
                                <h6>$\tan x$</h6>
                                $$\tan x \approx x$$
                            </div>
                            <div class="rule-item">
                                <h6>$e^x$</h6>
                                $$e^x \approx 1 + x$$
                            </div>
                            <div class="rule-item">
                                <h6>$\ln(1+x)$</h6>
                                $$\ln(1+x) \approx x$$
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 习题练习 -->
        <div class="content-section">
            <div class="section-header">
                <h2>习题练习</h2>
            </div>
            <div class="section-content">
                <div class="practice-problem">
                    <h4>习题1：微分计算 <span class="difficulty medium">中等难度</span></h4>
                    <p>求函数 $y = x^2 e^x \cos x$ 的微分。</p>
                    
                    <div class="solution">
                        <div class="solution-header">解：</div>
                        <p>方法一：先求导数再求微分</p>
                        <p>$y' = (x^2)' e^x \cos x + x^2 (e^x)' \cos x + x^2 e^x (\cos x)'$</p>
                        <p>$= 2x e^x \cos x + x^2 e^x \cos x + x^2 e^x (-\sin x)$</p>
                        <p>$= e^x (2x \cos x + x^2 \cos x - x^2 \sin x)$</p>
                        <p>$= x e^x (2\cos x + x \cos x - x \sin x)$</p>
                        
                        <p>因此：$dy = x e^x (2\cos x + x \cos x - x \sin x) dx$</p>
                        
                        <p>方法二：使用微分法则</p>
                        <p>设 $u = x^2$，$v = e^x$，$w = \cos x$</p>
                        <p>$du = 2x \, dx$，$dv = e^x dx$，$dw = -\sin x \, dx$</p>
                        
                        <p>$d(uvw) = vw \, du + uw \, dv + uv \, dw$</p>
                        <p>$= e^x \cos x \cdot 2x \, dx + x^2 \cos x \cdot e^x dx + x^2 e^x \cdot (-\sin x) dx$</p>
                        <p>$= x e^x (2\cos x + x \cos x - x \sin x) dx$</p>
                    </div>
                </div>
                
                <div class="practice-problem">
                    <h4>习题2：近似计算 <span class="difficulty hard">较难</span></h4>
                    <p>利用微分近似计算 $\sin 31°$ 的值（精确到小数点后四位）。</p>
                    
                    <div class="solution">
                        <div class="solution-header">解：</div>
                        <p>首先将角度转换为弧度：$31° = \frac{31\pi}{180} = \frac{31\pi}{180} \approx 0.5411$ 弧度</p>
                        
                        <p>取 $x_0 = \frac{\pi}{6} = 30°$，$\Delta x = \frac{\pi}{180} = 1°$ 对应的弧度</p>
                        
                        <p>设 $f(x) = \sin x$，则 $f'(x) = \cos x$</p>
                        <p>$f\left(\frac{\pi}{6}\right) = \sin 30° = \frac{1}{2}$</p>
                        <p>$f'\left(\frac{\pi}{6}\right) = \cos 30° = \frac{\sqrt{3}}{2}$</p>
                        
                        <p>应用近似公式：</p>
                        $$\sin 31° \approx \sin 30° + \cos 30° \cdot \frac{\pi}{180}$$
                        $$= \frac{1}{2} + \frac{\sqrt{3}}{2} \cdot \frac{\pi}{180}$$
                        $$= 0.5 + \frac{1.732}{2} \cdot \frac{3.1416}{180}$$
                        $$= 0.5 + 0.866 \times 0.01745 \approx 0.5151$$
                        
                        <p>精确值：$\sin 31° \approx 0.5150$，误差约为 $0.0001$</p>
                    </div>
                </div>
                
                <div class="practice-problem">
                    <h4>习题3：误差分析应用 <span class="difficulty very-hard">很难</span></h4>
                    <p>某圆锥的高 $h = 12$ cm，底面半径 $r = 5$ cm。现测量高和半径，测量的相对误差都不超过 $1\%$。求圆锥体积计算的相对误差估计值。</p>
                    
                    <div class="solution">
                        <div class="solution-header">解：</div>
                        <p>圆锥体积公式：$V = \frac{1}{3}\pi r^2 h$</p>
                        
                        <p><strong>步骤1：求偏导数</strong></p>
                        <p>$\frac{\partial V}{\partial r} = \frac{2\pi r h}{3}$，$\frac{\partial V}{\partial h} = \frac{\pi r^2}{3}$</p>
                        
                        <p><strong>步骤2：计算全微分</strong></p>
                        <p>$dV = \frac{\partial V}{\partial r} dr + \frac{\partial V}{\partial h} dh = \frac{2\pi r h}{3} dr + \frac{\pi r^2}{3} dh$</p>
                        
                        <p><strong>步骤3：求相对误差</strong></p>
                        <p>$\frac{dV}{V} = \frac{\frac{2\pi r h}{3} dr + \frac{\pi r^2}{3} dh}{\frac{1}{3}\pi r^2 h} = \frac{2dr}{r} + \frac{dh}{h}$</p>
                        
                        <p><strong>步骤4：估计最大相对误差</strong></p>
                        <p>已知：$\left|\frac{dr}{r}\right| \leq 1\% = 0.01$，$\left|\frac{dh}{h}\right| \leq 1\% = 0.01$</p>
                        
                        <p>最大相对误差：</p>
                        $$\left|\frac{dV}{V}\right| \leq 2\left|\frac{dr}{r}\right| + \left|\frac{dh}{h}\right| \leq 2 \times 1\% + 1\% = 3\%$$
                        
                        <p>因此，圆锥体积计算的相对误差不超过 $3\%$。</p>
                        
                        <p><strong>说明：</strong>在乘积型函数 $V = ar^2h$ 中，各变量的相对误差对总相对误差的贡献与它们的指数成正比。</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 导航按钮 -->
        <div class="nav-buttons">
            <a href="2.4.html" class="btn prev">2.4 隐函数、参数方程导数、相关变化率</a>
            <a href="../index.html" class="btn next">返回章节概览</a>
        </div>
        
        <footer>
            <p>© 2025 高等数学复习系统 - 导数与微分</p>
        </footer>
    </div>

    <script>
        // 微分几何意义交互式演示
        function createDifferentialGeometryDemo() {
            const functionSelect = document.getElementById('function-select');
            const x0Slider = document.getElementById('x0-slider');
            const dxSlider = document.getElementById('dx-slider');
            const x0Value = document.getElementById('x0-value');
            const dxValue = document.getElementById('dx-value');
            
            // 定义函数集合
            const functions = {
                quadratic: {
                    name: 'y = x²',
                    f: x => x * x,
                    fprime: x => 2 * x,
                    domain: [-3, 3],
                    range: [-0.5, 9]
                },
                cubic: {
                    name: 'y = x³',
                    f: x => x * x * x,
                    fprime: x => 3 * x * x,
                    domain: [-2.5, 2.5],
                    range: [-8, 8]
                },
                sqrt: {
                    name: 'y = √x',
                    f: x => Math.sqrt(Math.max(0, x)),
                    fprime: x => x > 0 ? 1/(2*Math.sqrt(x)) : 0,
                    domain: [0, 4],
                    range: [-0.2, 2.5]
                },
                sin: {
                    name: 'y = sin(x)',
                    f: x => Math.sin(x),
                    fprime: x => Math.cos(x),
                    domain: [-Math.PI, Math.PI],
                    range: [-1.5, 1.5]
                },
                exp: {
                    name: 'y = eˣ',
                    f: x => Math.exp(x),
                    fprime: x => Math.exp(x),
                    domain: [-2, 2],
                    range: [0, 8]
                }
            };
            
            function updatePlot() {
                const selectedFunction = functions[functionSelect.value];
                const x0 = parseFloat(x0Slider.value);
                const dx = parseFloat(dxSlider.value);
                
                // 更新显示值
                x0Value.textContent = x0.toFixed(1);
                dxValue.textContent = dx.toFixed(2);
                
                // 调整x0滑块范围
                if (functionSelect.value === 'sqrt') {
                    x0Slider.min = '0.1';
                    x0Slider.max = '3.5';
                    if (x0 < 0.1) {
                        x0Slider.value = '0.1';
                        x0Value.textContent = '0.1';
                    }
                } else {
                    x0Slider.min = '-2';
                    x0Slider.max = '3';
                }
                
                const actualX0 = parseFloat(x0Slider.value);
                const actualDx = parseFloat(dxSlider.value);
                
                // 生成函数曲线数据
                const x = [];
                const y = [];
                const domain = selectedFunction.domain;
                const step = (domain[1] - domain[0]) / 200;
                
                for (let xi = domain[0]; xi <= domain[1]; xi += step) {
                    if (functionSelect.value === 'sqrt' && xi < 0) continue;
                    x.push(xi);
                    y.push(selectedFunction.f(xi));
                }
                
                // 计算关键点和值
                const y0 = selectedFunction.f(actualX0);
                const x1 = actualX0 + actualDx;
                const y1 = selectedFunction.f(x1);
                const slope = selectedFunction.fprime(actualX0);
                const dy = slope * actualDx;
                const deltaY = y1 - y0;
                const error = Math.abs(deltaY - dy);
                
                // 生成切线数据
                const tangentX = [actualX0 - actualDx, actualX0 + 2*actualDx];
                const tangentY = tangentX.map(xi => y0 + slope * (xi - actualX0));
                
                const traces = [
                    {
                        x: x,
                        y: y,
                        type: 'scatter',
                        mode: 'lines',
                        name: selectedFunction.name,
                        line: { color: '#8e44ad', width: 3 }
                    },
                    {
                        x: tangentX,
                        y: tangentY,
                        type: 'scatter',
                        mode: 'lines',
                        name: '切线',
                        line: { color: '#e74c3c', width: 2, dash: 'dash' }
                    },
                    {
                        x: [actualX0, x1],
                        y: [y0, y0],
                        type: 'scatter',
                        mode: 'lines+markers',
                        name: 'Δx',
                        marker: { color: '#2c3e50', size: 8 },
                        line: { color: '#2c3e50', width: 2 }
                    },
                    {
                        x: [x1, x1],
                        y: [y0, y1],
                        type: 'scatter',
                        mode: 'lines',
                        name: `Δy = ${deltaY.toFixed(4)}`,
                        line: { color: '#27ae60', width: 4 }
                    },
                    {
                        x: [x1, x1],
                        y: [y0, y0 + dy],
                        type: 'scatter',
                        mode: 'lines',
                        name: `dy = ${dy.toFixed(4)}`,
                        line: { color: '#f39c12', width: 4 }
                    }
                ];
                
                // 如果误差足够大，显示误差线段
                if (error > 0.001) {
                    traces.push({
                        x: [x1, x1],
                        y: [y0 + dy, y1],
                        type: 'scatter',
                        mode: 'lines',
                        name: `误差 = ${error.toFixed(4)}`,
                        line: { color: '#e67e22', width: 3, dash: 'dot' }
                    });
                }
                
                // 添加重要点标记
                traces.push({
                    x: [actualX0, x1],
                    y: [y0, y1],
                    type: 'scatter',
                    mode: 'markers',
                    name: '关键点',
                    marker: { 
                        color: ['#8e44ad', '#27ae60'], 
                        size: [10, 8],
                        symbol: ['circle', 'square']
                    },
                    showlegend: false
                });
                
                const layout = {
                    title: {
                        text: `微分的几何意义：${selectedFunction.name}<br>x₀=${actualX0.toFixed(1)}, Δx=${actualDx.toFixed(2)}, Δy=${deltaY.toFixed(4)}, dy=${dy.toFixed(4)}`,
                        font: { size: 14 }
                    },
                    xaxis: { 
                        title: 'x',
                        range: [Math.min(domain[0], actualX0 - 1), Math.max(domain[1], x1 + 0.5)],
                        zeroline: true,
                        gridcolor: 'rgba(128,128,128,0.2)'
                    },
                    yaxis: { 
                        title: 'y',
                        range: selectedFunction.range,
                        zeroline: true,
                        gridcolor: 'rgba(128,128,128,0.2)'
                    },
                    showlegend: true,
                    legend: {
                        x: 0.02,
                        y: 0.98,
                        bgcolor: 'rgba(255,255,255,0.8)',
                        bordercolor: 'rgba(0,0,0,0.2)',
                        borderwidth: 1
                    },
                    plot_bgcolor: 'rgba(0,0,0,0)',
                    paper_bgcolor: 'rgba(0,0,0,0)',
                    font: { family: 'Microsoft YaHei', size: 11 },
                    margin: { l: 50, r: 50, t: 80, b: 50 },
                    annotations: [
                        {
                            x: actualX0,
                            y: y0,
                            text: `(${actualX0.toFixed(1)}, ${y0.toFixed(2)})`,
                            showarrow: true,
                            arrowhead: 2,
                            arrowsize: 1,
                            arrowwidth: 1,
                            arrowcolor: '#8e44ad',
                            ax: 20,
                            ay: -30,
                            font: { size: 10, color: '#8e44ad' }
                        },
                        {
                            x: x1,
                            y: y1,
                            text: `(${x1.toFixed(1)}, ${y1.toFixed(2)})`,
                            showarrow: true,
                            arrowhead: 2,
                            arrowsize: 1,
                            arrowwidth: 1,
                            arrowcolor: '#27ae60',
                            ax: -20,
                            ay: 30,
                            font: { size: 10, color: '#27ae60' }
                        }
                    ]
                };
                
                Plotly.newPlot('differential-geometry-plot', traces, layout, {
                    responsive: true,
                    displayModeBar: false
                });
            }
            
            // 事件监听器
            functionSelect.addEventListener('change', updatePlot);
            x0Slider.addEventListener('input', updatePlot);
            dxSlider.addEventListener('input', updatePlot);
            
            // 初始化绘图
            updatePlot();
        }
        
        // 近似计算演示
        function createApproximationDemo() {
            const trueX = [];
            const trueY = [];
            const approxY = [];
            const errorY = [];
            
            // 真实函数 f(x) = sqrt(x)
            const x0 = 4;
            const f = (x) => Math.sqrt(x);
            const fprime = (x) => 1/(2*Math.sqrt(x));
            
            for (let x = 3.5; x <= 4.5; x += 0.01) {
                trueX.push(x);
                trueY.push(f(x));
                
                // 线性近似
                const approx = f(x0) + fprime(x0) * (x - x0);
                approxY.push(approx);
                errorY.push(Math.abs(f(x) - approx));
            }
            
            const trace1 = {
                x: trueX,
                y: trueY,
                type: 'scatter',
                mode: 'lines',
                name: 'f(x) = √x',
                line: { color: '#8e44ad', width: 3 }
            };
            
            const trace2 = {
                x: trueX,
                y: approxY,
                type: 'scatter',
                mode: 'lines',
                name: '线性近似',
                line: { color: '#e74c3c', width: 2, dash: 'dash' }
            };
            
            const trace3 = {
                x: [x0],
                y: [f(x0)],
                type: 'scatter',
                mode: 'markers',
                name: '基准点 (4, 2)',
                marker: { color: '#27ae60', size: 10 }
            };
            
            const layout = {
                title: '微分在近似计算中的应用：√x ≈ 2 + 1/4·(x-4)',
                xaxis: { 
                    title: 'x',
                    range: [3.5, 4.5]
                },
                yaxis: { 
                    title: 'y',
                    range: [1.87, 2.13]
                },
                showlegend: true,
                plot_bgcolor: 'rgba(0,0,0,0)',
                paper_bgcolor: 'rgba(0,0,0,0)',
                font: { family: 'Microsoft YaHei', size: 12 }
            };
            
            Plotly.newPlot('approximation-plot', [trace1, trace2, trace3], layout, {responsive: true});
        }
        
        // 误差分析交互式演示
        function createErrorAnalysisDemo() {
            const errorFunctionSelect = document.getElementById('error-function-select');
            const x0ErrorSlider = document.getElementById('x0-error-slider');
            const maxDxSlider = document.getElementById('max-dx-slider');
            const x0ErrorValue = document.getElementById('x0-error-value');
            const maxDxValue = document.getElementById('max-dx-value');
            const errorStats = document.getElementById('error-stats');
            
            // 定义函数集合
            const functions = {
                sqrt: {
                    name: '√x',
                    f: x => Math.sqrt(x),
                    fprime: x => 1/(2*Math.sqrt(x)),
                    domain: [0.1, 4],
                    x0Range: [0.5, 3.5]
                },
                quadratic: {
                    name: 'x²',
                    f: x => x * x,
                    fprime: x => 2 * x,
                    domain: [-3, 3],
                    x0Range: [0.5, 3]
                },
                sin: {
                    name: 'sin(x)',
                    f: x => Math.sin(x),
                    fprime: x => Math.cos(x),
                    domain: [-Math.PI, Math.PI],
                    x0Range: [0.5, 2.5]
                },
                exp: {
                    name: 'eˣ',
                    f: x => Math.exp(x),
                    fprime: x => Math.exp(x),
                    domain: [-2, 2],
                    x0Range: [0.1, 2]
                },
                ln: {
                    name: 'ln(x)',
                    f: x => Math.log(x),
                    fprime: x => 1/x,
                    domain: [0.1, 4],
                    x0Range: [0.5, 3.5]
                }
            };
            
            function updateErrorAnalysis() {
                const selectedFunction = functions[errorFunctionSelect.value];
                const x0 = parseFloat(x0ErrorSlider.value);
                const maxDx = parseFloat(maxDxSlider.value);
                
                // 更新显示值
                x0ErrorValue.textContent = x0.toFixed(1);
                maxDxValue.textContent = maxDx.toFixed(2);
                
                // 调整x0滑块范围
                const range = selectedFunction.x0Range;
                x0ErrorSlider.min = range[0].toString();
                x0ErrorSlider.max = range[1].toString();
                
                const actualX0 = parseFloat(x0ErrorSlider.value);
                
                // 生成误差数据
                const deltaX = [];
                const absoluteErrors = [];
                const relativeErrors = [];
                const trueValues = [];
                const approxValues = [];
                
                const steps = 100;
                for (let i = 0; i <= steps; i++) {
                    const dx = (2 * maxDx * i / steps) - maxDx; // 从 -maxDx 到 +maxDx
                    const x = actualX0 + dx;
                    
                    // 确保x在定义域内
                    if (x < selectedFunction.domain[0] || x > selectedFunction.domain[1]) continue;
                    
                    const trueValue = selectedFunction.f(x);
                    const approxValue = selectedFunction.f(actualX0) + selectedFunction.fprime(actualX0) * dx;
                    const absoluteError = Math.abs(trueValue - approxValue);
                    const relativeError = Math.abs(absoluteError / trueValue) * 100;
                    
                    deltaX.push(dx);
                    absoluteErrors.push(absoluteError);
                    relativeErrors.push(isFinite(relativeError) ? relativeError : 0);
                    trueValues.push(trueValue);
                    approxValues.push(approxValue);
                }
                
                // 计算统计信息
                const maxAbsoluteError = Math.max(...absoluteErrors);
                const maxRelativeError = Math.max(...relativeErrors);
                
                // 更新统计显示
                errorStats.innerHTML = `
                    <p><strong>实时统计：</strong></p>
                    <p>函数：f(x) = ${selectedFunction.name}</p>
                    <p>基准点：x₀ = ${actualX0.toFixed(1)}</p>
                    <p>最大绝对误差：${maxAbsoluteError.toFixed(6)}</p>
                    <p>最大相对误差：${maxRelativeError.toFixed(2)}%</p>
                `;
                
                const traces = [
                    {
                        x: deltaX,
                        y: absoluteErrors,
                        type: 'scatter',
                        mode: 'lines',
                        name: '绝对误差 |真实值 - 近似值|',
                        line: { color: '#e74c3c', width: 3 },
                        yaxis: 'y'
                    },
                    {
                        x: deltaX,
                        y: relativeErrors,
                        type: 'scatter',
                        mode: 'lines',
                        name: '相对误差 (%)',
                        line: { color: '#3498db', width: 3 },
                        yaxis: 'y2'
                    }
                ];
                
                // 添加零点参考线
                const zeroLineTrace = {
                    x: [0, 0],
                    y: [0, Math.max(...absoluteErrors) * 1.1],
                    type: 'scatter',
                    mode: 'lines',
                    name: 'Δx = 0 (基准点)',
                    line: { color: '#95a5a6', width: 2, dash: 'dash' },
                    yaxis: 'y',
                    showlegend: false
                };
                traces.push(zeroLineTrace);
                
                // 添加误差最小区域标记
                const smallErrorRegion = deltaX.filter(dx => Math.abs(dx) <= maxDx/4);
                if (smallErrorRegion.length > 0) {
                    traces.push({
                        x: [-maxDx/4, maxDx/4, maxDx/4, -maxDx/4, -maxDx/4],
                        y: [0, 0, Math.max(...absoluteErrors) * 1.1, Math.max(...absoluteErrors) * 1.1, 0],
                        type: 'scatter',
                        mode: 'lines',
                        name: '高精度区域',
                        fill: 'toself',
                        fillcolor: 'rgba(46, 204, 113, 0.1)',
                        line: { color: 'rgba(46, 204, 113, 0.3)', width: 1 },
                        yaxis: 'y',
                        showlegend: true
                    });
                }
                
                const layout = {
                    title: {
                        text: `微分近似的误差分析：f(x) = ${selectedFunction.name}, x₀ = ${actualX0.toFixed(1)}`,
                        font: { size: 14 }
                    },
                    xaxis: { 
                        title: 'Δx (增量)',
                        range: [-maxDx * 1.1, maxDx * 1.1],
                        zeroline: true,
                        gridcolor: 'rgba(128,128,128,0.2)'
                    },
                    yaxis: {
                        title: '绝对误差',
                        side: 'left',
                        range: [0, Math.max(...absoluteErrors) * 1.1],
                        gridcolor: 'rgba(128,128,128,0.2)'
                    },
                    yaxis2: {
                        title: '相对误差 (%)',
                        overlaying: 'y',
                        side: 'right',
                        range: [0, Math.max(...relativeErrors) * 1.1],
                        gridcolor: 'rgba(128,128,128,0.1)'
                    },
                    showlegend: true,
                    legend: {
                        x: 0.02,
                        y: 0.98,
                        bgcolor: 'rgba(255,255,255,0.8)',
                        bordercolor: 'rgba(0,0,0,0.2)',
                        borderwidth: 1
                    },
                    plot_bgcolor: 'rgba(0,0,0,0)',
                    paper_bgcolor: 'rgba(0,0,0,0)',
                    font: { family: 'Microsoft YaHei', size: 11 },
                    margin: { l: 60, r: 60, t: 60, b: 50 },
                    annotations: [
                        {
                            x: 0,
                            y: Math.max(...absoluteErrors) * 0.8,
                            text: `在 Δx = 0 处<br>误差为零<br>(完美近似)`,
                            showarrow: true,
                            arrowhead: 2,
                            arrowsize: 1,
                            arrowcolor: '#95a5a6',
                            ax: 30,
                            ay: -50,
                            font: { size: 10, color: '#7f8c8d' },
                            bgcolor: 'rgba(255,255,255,0.8)',
                            bordercolor: '#95a5a6',
                            borderwidth: 1
                        }
                    ]
                };
                
                Plotly.newPlot('error-analysis-plot', traces, layout, {
                    responsive: true,
                    displayModeBar: false
                });
            }
            
            // 事件监听器
            errorFunctionSelect.addEventListener('change', updateErrorAnalysis);
            x0ErrorSlider.addEventListener('input', updateErrorAnalysis);
            maxDxSlider.addEventListener('input', updateErrorAnalysis);
            
            // 初始化
            updateErrorAnalysis();
        }
        
        // 页面加载动画
        function initializeAnimations() {
            const contentSections = document.querySelectorAll('.content-section');
            if (contentSections.length > 0 && typeof gsap !== 'undefined') {
                gsap.from('.content-section', {
                    duration: 0.8,
                    y: 30,
                    opacity: 0,
                    stagger: 0.2,
                    ease: "power2.out"
                });
            }
            
            const formulaCards = document.querySelectorAll('.formula-card');
            if (formulaCards.length > 0 && typeof gsap !== 'undefined') {
                gsap.from('.formula-card', {
                    duration: 0.6,
                    scale: 0.8,
                    opacity: 0,
                    stagger: 0.1,
                    delay: 1,
                    ease: "back.out(1.7)"
                });
            }
        }
        
        // 滚动触发动画
        function setupScrollAnimations() {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting && typeof gsap !== 'undefined') {
                        gsap.from(entry.target.querySelectorAll('.definition, .theorem, .example'), {
                            duration: 0.6,
                            y: 20,
                            opacity: 0,
                            stagger: 0.1,
                            ease: "power2.out"
                        });
                    }
                });
            }, { threshold: 0.2 });
            
            document.querySelectorAll('.content-section').forEach(section => {
                observer.observe(section);
            });
        }
        
        // 页面加载时初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 延迟执行以确保DOM完全加载
            setTimeout(() => {
                createDifferentialGeometryDemo();
                createApproximationDemo();
                createErrorAnalysisDemo();
                initializeAnimations();
                setupScrollAnimations();
            }, 500);
            
            // MathJax 加载完成后的回调
            if (typeof MathJax !== 'undefined') {
                MathJax.startup.promise.then(() => {
                    console.log('MathJax loaded successfully');
                });
            }
        });
    </script>
</body>
</html>
